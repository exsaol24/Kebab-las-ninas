{# templates/inicio/index.html.twig #}
{% extends 'base.html.twig' %}

{% set page_css = 'inicio' %}

{% block title %}Inicio - Kebab Las Niñas{% endblock %}

{% block body %}

    <section class="banner" style="margin-top: 0;">
        <div class="banner-content">
            <h2>¡El mejor sabor en cada bocado!</h2>
            <p>Disfruta de nuestros kebabs únicos y deliciosos.</p>
            <a href="sobrenosotros" class="btn btn-primary">Conócenos</a>
        </div>
        <div class="banner-image">
            <img src="{{ asset('img/sobrekebab1.png') }}" alt="Deliciosos Kebabs">
        </div>
    </section>

    {# Carrusel de Ofertas #}
    <section class="ofertas-carousel-section">
        <div class="ofertas-carousel-container">
            <div class="ofertas-carousel" id="ofertasCarousel">
                <div class="oferta-slide active">
                    <img src="{{ asset('img/oferta1.jpg') }}" alt="Oferta 1">
                    <div class="oferta-info">
                        <h3>2x1 en Kebabs Clásicos</h3>
                        <p>¡Solo los miércoles! Ven con un amigo y paga solo uno.</p>
                    </div>
                </div>
                <div class="oferta-slide">
                    <img src="{{ asset('img/oferta2.jpg') }}" alt="Oferta 2">
                    <div class="oferta-info">
                        <h3>Menú Familiar</h3>
                        <p>4 kebabs + patatas + bebida grande por solo 19,90€.</p>
                    </div>
                </div>
                <div class="oferta-slide">
                    <img src="{{ asset('img/oferta3.jpg') }}" alt="Oferta 3">
                    <div class="oferta-info">
                        <h3>Bebida gratis</h3>
                        <p>Con cada kebab XL, llévate una bebida gratis.</p>
                    </div>
                </div>
            </div>
            <button class="ofertas-carousel-btn prev" id="ofertasPrev">❮</button>
            <button class="ofertas-carousel-btn next" id="ofertasNext">❯</button>
             <div class="ofertas-carousel-dots">
                <span class="ofertas-carousel-dot active" data-slide="0"></span>
                <span class="ofertas-carousel-dot" data-slide="1"></span>
                <span class="ofertas-carousel-dot" data-slide="2"></span>
            </div>
        </div>
    </section>

    {# Zona de mapa  #}
    <section class="ubicacion-section">
        <div class="ubicacion-container">
            <div class="ubicacion-info">
                <h2>¿Dónde estamos?</h2>
                <p>
                    <strong>Av. Arias de Velasco, 58, 29601 Marbella, Málaga</strong><br>
                    ¡Ven a visitarnos y disfruta del mejor kebab de la ciudad!
                </p>
            </div>
            <div class="ubicacion-mapa">
                <iframe
                    src="https://www.google.com/maps?q=Av.+Arias+de+Velasco,+58,+29601+Marbella,+M%C3%A1laga&hl=es&output=embed"
                    width="400"
                    height="250"
                    style="border:0; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.15); width:100%;"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
        </div>
    </section>

    <section id="testimonials" class="testimonials">
        <h2>Lo que dicen nuestros clientes</h2>
        <div class="testimonials-grid">
            <div class="testimonial-card">
                <p>"¡El mejor kebab que he probado! Definitivamente volveré."</p>
                <span>- Albertito Pérez</span>
            </div>
            <div class="testimonial-card">
                <p>"Excelente servicio y comida deliciosa. Muy recomendado."</p>
                <span>- Marina López</span>
            </div>
            <div class="testimonial-card">
                <p>"Un lugar perfecto para disfrutar con amigos y familia."</p>
                <span>- Kevin Soto</span>
            </div>
        </div>
    </section>

    <section id="platos" class="platos">
        <h2>Nuestros Platos</h2>
        <div class="platos-grid">
            {% for plato in platos %}
                <div class="plato-card">
                    <img src="{{ asset(plato.imagen) }}" alt="{{ plato.nombre }}" class="plato-imagen">
                    <div class="plato-info">
                        <h3 class="plato-nombre">{{ plato.nombre }}</h3>
                        <p class="plato-descripcion">{{ plato.descripcion }}</p>
                        <p class="plato-precio">{{ plato.precio | number_format(2, '.', ',') }} €</p>

                        {% if app.session.get('user_name') is not null %}
                            <a href="{{ path('app_carrito_agregar', {'id': plato.id}) }}"
                               class="btn btn-add-to-cart js-add-to-cart"
                               data-plato-id="{{ plato.id }}">
                                Añadir al carrito
                            </a>
                        {% else %}
                            <span class="btn btn-add-to-cart js-login-required"
                                data-login-message="Debes iniciar sesión para añadir productos al carrito.">
                                Añadir al carrito
                            </span>
                        {% endif %}

                    </div>
                </div>
            {% else %}
                <p>No hay platos disponibles en este momento.</p>
            {% endfor %}
        </div>
    </section>

    <footer id="contact" class="footer">
        <p>© 2025 Kebab Las Niñas. Todos los derechos reservados.</p>
        <p>Contacto: <a href="mailto:info@kebablasniñas.com">info@kebablasniñas.com</a></p>
        <p>Síguenos en nuestras redes sociales:</p>
        <div class="social-links">
            <a href="https://es-es.facebook.com/"><img src="{{ asset('img/facebook.png') }}" alt="Facebook"></a>
            <a href="https://www.instagram.com/kebab_lasninas/"><img src="{{ asset('img/instagram.png') }}" alt="Instagram"></a>
            <a href="https://x.com/"><img src="{{ asset('img/x.png') }}" alt="Twitter"></a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Carrusel de ofertas
            let currentOferta = 0;
            const slides = document.querySelectorAll('.oferta-slide');
            const totalOfertas = slides.length;
            const prevBtn = document.getElementById('ofertasPrev');
            const nextBtn = document.getElementById('ofertasNext');
            const dots = document.querySelectorAll('.ofertas-carousel-dot');

            function showOferta(idx) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === idx);
                });
                 dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === idx);
                });
            }
            function nextOferta() {
                currentOferta = (currentOferta + 1) % totalOfertas;
                showOferta(currentOferta);
            }
            function prevOferta() {
                currentOferta = (currentOferta - 1 + totalOfertas) % totalOfertas;
                showOferta(currentOferta);
            }
            if (prevBtn && nextBtn) {
                prevBtn.addEventListener('click', prevOferta);
                nextBtn.addEventListener('click', nextOferta);
            }

            dots.forEach(dot => {
                dot.addEventListener('click', function() {
                    const slideIndex = parseInt(this.dataset.slide);
                    currentOferta = slideIndex;
                    showOferta(currentOferta);
                });
            });

            // Auto-slide cada 6 segundos
            setInterval(nextOferta, 6000);
            showOferta(currentOferta);

            // Manejo para usuarios no logueados
            const loginRequiredButtons = document.querySelectorAll('.js-login-required');
            loginRequiredButtons.forEach(button => {
                button.addEventListener('click', function (event) {
                    event.preventDefault();
                    const message = this.dataset.loginMessage || 'Debes iniciar sesión.';
                    alert(message);
                });
            });

            // AJAX para añadir al carrito
            const addToCartButtons = document.querySelectorAll('.js-add-to-cart');
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function (event) {
                    event.preventDefault();
                    const platoId = this.dataset.platoId;
                    fetch('{{ path('app_carrito_agregar', {'id': 'PLATO_ID'}) }}'.replace('PLATO_ID', platoId), {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Plato añadido al carrito.');
                            // Actualizar contador carrito en navbar
                            let cartCount = document.querySelector('.cart-count');
                            if (!cartCount) {
                                // Buscar el enlace del carrito
                                const cartLink = document.querySelector('.cart-icon-link');
                                if (cartLink) {
                                    cartCount = document.createElement('span');
                                    cartCount.className = 'cart-count';
                                    cartLink.appendChild(cartCount);
                                }
                            }
                            if (cartCount) {
                                cartCount.textContent = data.total_productos_carrito;
                                cartCount.style.display = data.total_productos_carrito > 0 ? 'inline-block' : 'none';
                            }
                        } else {
                            alert(data.message || 'Error al añadir al carrito.');
                        }
                    })
                    .catch(() => {
                        alert('Error de red al añadir al carrito.');
                    });
                });
            });
        });
    </script>

{% endblock %}